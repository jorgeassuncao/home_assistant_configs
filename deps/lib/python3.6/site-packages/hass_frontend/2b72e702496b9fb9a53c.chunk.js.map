{"version":3,"sources":["webpack:///./src/panels/calendar/ha-big-calendar.js","webpack:///./src/panels/calendar/ha-panel-calendar.js"],"names":["lib_default","a","setLocalizer","momentLocalizer","moment_default","customElements","define","Object","events_mixin","polymer_element","template","html_tag","properties","events","type","Array","observer","_update","allViews","Views","values","BCElement","preact_compat_es","default","createElement","views","popup","onNavigate","date","viewName","this","fire","onView","eventPropGetter","_setEventStyle","defaultView","defaultDate","Date","render","$","root","event","newStyle","color","backgroundColor","style","localize_mixin","hass","currentView","String","value","currentDate","calendars","selectedCalendars","narrow","Boolean","reflectToAttribute","showMenu","connectedCallback","super","_fetchCalendars","callApi","then","result","map","cal","entity_id","_fetchData","start","dates_default","firstVisibleDay","toISOString","end","lastVisibleDay","params","encodeURI","calls","Promise","all","results","tmpEvents","forEach","res","ev","push","_getDateRange","startDate","endDate","startOf","endOf","subtract","add","_handleViewChanged","detail","_handleNavigate"],"mappings":"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","file":"2b72e702496b9fb9a53c.chunk.js","sourcesContent":["import { html } from '@polymer/polymer/lib/utils/html-tag.js';\nimport { PolymerElement } from '@polymer/polymer/polymer-element.js';\n\n/* eslint-disable */\nimport { render } from 'react-dom';\nimport React from 'react';\n/* eslint-enable */\nimport BigCalendar from 'react-big-calendar';\nimport moment from 'moment';\nimport EventsMixin from '../../mixins/events-mixin.js';\n\nimport '../../resources/ha-style.js';\n\nBigCalendar.setLocalizer(BigCalendar.momentLocalizer(moment));\n\nconst DEFAULT_VIEW = 'month';\n\nclass HaBigCalendar extends EventsMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <link rel=\"stylesheet\" href=\"/static/panels/calendar/react-big-calendar.css\">\n      <style>\n        div#root {\n          height: 100%;\n          width: 100%;\n        }\n      </style>\n      <div id=\"root\"></div>`;\n  }\n\n  static get properties() {\n    return {\n      events: {\n        type: Array,\n        observer: '_update',\n      },\n\n    };\n  }\n\n  _update(events) {\n    const allViews = BigCalendar.Views.values;\n\n    const BCElement = React.createElement(\n      BigCalendar,\n      { events: events,\n        views: allViews,\n        popup: true,\n        onNavigate: (date, viewName) => this.fire('navigate', { date, viewName }),\n        onView: viewName => this.fire('view-changed', { viewName }),\n        eventPropGetter: this._setEventStyle,\n        defaultView: DEFAULT_VIEW,\n        defaultDate: new Date(),\n      }\n    );\n    render(BCElement, this.$.root);\n  }\n\n  _setEventStyle(event) {\n    // https://stackoverflow.com/questions/34587067/change-color-of-react-big-calendar-events\n    const newStyle = {};\n    if (event.color) {\n      newStyle.backgroundColor = event.color;\n    }\n    return { style: newStyle };\n  }\n}\n\ncustomElements.define('ha-big-calendar', HaBigCalendar);\n","import '@polymer/app-layout/app-header-layout/app-header-layout.js';\nimport '@polymer/app-layout/app-header/app-header.js';\nimport '@polymer/app-layout/app-toolbar/app-toolbar.js';\nimport '@polymer/paper-listbox/paper-listbox.js';\nimport '@polymer/paper-card/paper-card.js';\nimport '@polymer/paper-checkbox/paper-checkbox.js';\nimport '@polymer/paper-item/paper-item.js';\nimport { html } from '@polymer/polymer/lib/utils/html-tag.js';\nimport { PolymerElement } from '@polymer/polymer/polymer-element.js';\nimport moment from 'moment';\nimport dates from 'react-big-calendar/lib/utils/dates';\n\nimport '../../components/ha-menu-button.js';\nimport '../../resources/ha-style.js';\nimport './ha-big-calendar.js';\n\nimport LocalizeMixin from '../../mixins/localize-mixin.js';\n\nconst DEFAULT_VIEW = 'month';\n\n/*\n * @appliesMixin LocalizeMixin\n */\nclass HaPanelCalendar extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style include=\"iron-flex ha-style\">\n        .content {\n          padding: 16px;\n          @apply --layout-horizontal;\n        }\n\n        ha-big-calendar {\n          min-height: 500px;\n          min-width: 100%;\n        }\n\n        #calendars {\n          padding-right: 16px;\n          width: 15%;\n          min-width: 170px;\n        }\n\n        paper-item {\n          cursor: pointer;\n        }\n\n        div.all_calendars {\n    ￼     height: 20px;\n    ￼     text-align: center;\n        }\n\n        .iron-selected {\n          background-color: #e5e5e5;\n          font-weight: normal;\n        }\n\n        :host([narrow]) .content {\n          flex-direction: column;\n        }\n        :host([narrow]) #calendars {\n          margin-bottom: 24px;\n          width: 100%;\n        }\n      </style>\n\n      <app-header-layout has-scrolling-region>\n        <app-header slot=\"header\" fixed>\n          <app-toolbar>\n            <ha-menu-button narrow='[[narrow]]' show-menu='[[showMenu]]'></ha-menu-button>\n            <div main-title>[[localize('panel.calendar')]]</div>\n          </app-toolbar>\n        </app-header>\n\n        <div class=\"flex content\">\n          <div id=\"calendars\" class=\"layout vertical wrap\">\n            <paper-card heading=\"Calendars\">\n              <paper-listbox\n                id=\"calendar_list\"\n                multi\n                on-selected-items-changed=\"_fetchData\"\n                selected-values=\"{{selectedCalendars}}\"\n                attr-for-selected=\"item-name\"\n              >\n                <template is=\"dom-repeat\" items=\"[[calendars]]\">\n                  <paper-item item-name=\"[[item.entity_id]]\">\n                    <span class=\"calendar_color\" style$=\"background-color: [[item.color]]\"></span>\n                    <span class=\"calendar_color_spacer\"></span>\n                    [[item.name]]\n                  </paper-item>\n                </template>\n              </paper-listbox>\n            </paper-card>\n          </div>\n          <div class=\"flex layout horizontal wrap\">\n            <ha-big-calendar\n              default-date=\"[[currentDate]]\"\n              default-view=\"[[currentView]]\"\n              on-navigate='_handleNavigate'\n              on-view='_handleViewChanged'\n              events=\"[[events]]\">\n            </ha-big-calendar>\n          </div>\n        </div>\n      </app-header-layout>`;\n  }\n\n  static get properties() {\n    return {\n      hass: Object,\n\n      currentView: {\n        type: String,\n        value: DEFAULT_VIEW\n      },\n\n      currentDate: {\n        type: Object,\n        value: new Date()\n      },\n\n      events: {\n        type: Array,\n        value: [],\n      },\n\n      calendars: {\n        type: Array,\n        value: [],\n      },\n\n      selectedCalendars: {\n        type: Array,\n        value: [],\n      },\n\n      narrow: {\n        type: Boolean,\n        reflectToAttribute: true,\n      },\n\n      showMenu: {\n        type: Boolean,\n        value: false,\n      },\n\n    };\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._fetchCalendars();\n  }\n\n  _fetchCalendars() {\n    this.hass.callApi('get', 'calendars')\n      .then((result) => {\n        this.calendars = result;\n        this.selectedCalendars = result.map(cal => cal.entity_id);\n      });\n  }\n\n  _fetchData() {\n    const start = dates.firstVisibleDay(this.currentDate).toISOString();\n    const end = dates.lastVisibleDay(this.currentDate).toISOString();\n    const params = encodeURI(`?start=${start}&end=${end}`);\n    const calls = this.selectedCalendars.map(cal => this.hass.callApi('get', `calendars/${cal}${params}`));\n    Promise.all(calls).then((results) => {\n      const tmpEvents = [];\n\n      results.forEach((res) => {\n        res.forEach((ev) => {\n          ev.start = new Date(ev.start);\n          if (ev.end) {\n            ev.end = new Date(ev.end);\n          } else {\n            ev.end = null;\n          }\n          tmpEvents.push(ev);\n        });\n      });\n      this.events = tmpEvents;\n    });\n  }\n\n  _getDateRange() {\n    let startDate;\n    let endDate;\n    if (this.currentView === 'day') {\n      startDate = moment(this.currentDate).startOf('day');\n      endDate = moment(this.currentDate).startOf('day');\n    } else if (this.currentView === 'week') {\n      startDate = moment(this.currentDate).startOf('isoWeek');\n      endDate = moment(this.currentDate).endOf('isoWeek');\n    } else if (this.currentView === 'month') {\n      startDate = moment(this.currentDate).startOf('month').subtract(7, 'days');\n      endDate = moment(this.currentDate).endOf('month').add(7, 'days');\n    } else if (this.currentView === 'agenda') {\n      startDate = moment(this.currentDate).startOf('day');\n      endDate = moment(this.currentDate).endOf('day').add(1, 'month');\n    }\n    return [startDate.toISOString(), endDate.toISOString()];\n  }\n\n  _handleViewChanged(ev) {\n    // Calendar view changed\n    this.currentView = ev.detail.viewName;\n    this._fetchData();\n  }\n\n  _handleNavigate(ev) {\n    // Calendar date range changed\n    this.currentDate = ev.detail.date;\n    this.currentView = ev.detail.viewName;\n    this._fetchData();\n  }\n}\n\ncustomElements.define('ha-panel-calendar', HaPanelCalendar);\n"],"sourceRoot":""}